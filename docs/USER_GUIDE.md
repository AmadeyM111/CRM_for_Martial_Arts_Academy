# BJJ Academy CRM System - Руководство пользователя

## Обзор системы

CRM система для академии бразильского джиу-джитсу предназначена для управления учениками, отслеживания посещаемости, обработки платежей и автоматических уведомлений.

## Основные функции

### 1. Управление учениками
- **Добавление новых учеников**: Имя, фамилия, телефон, Telegram ID, email, текущий пояс
- **Редактирование информации**: Обновление контактных данных и прогресса
- **Отслеживание прогресса**: Количество занятий, текущий пояс
- **Фильтрация**: По поясам, статусу активности

### 2. Система тренировок
- **Расписание**: Понедельник, среда, пятница в 20:30
- **Тренеры**: Основной и резервный тренер
- **Отслеживание посещаемости**: Присутствие, отсутствие, опоздание
- **История тренировок**: Полная история всех занятий

### 3. Платежная система
- **Месячные подписки**: 8000 рублей в месяц
- **Разовые тренировки**: 1500 рублей за занятие
- **Отслеживание платежей**: История всех платежей
- **Автоматические напоминания**: О продлении подписки

### 4. Система поясов
- **Прогресс по поясам**: White → Blue → Purple → Brown → Black
- **Экзамены на пояса**: Запись результатов экзаменов
- **Автоматическое обновление**: Пояса обновляются после успешного экзамена

### 5. Уведомления
- **Telegram интеграция**: Автоматические уведомления
- **Напоминания о тренировках**: За 2 часа до занятия
- **Уведомления о пропусках**: Если пропущено более 2 занятий подряд
- **Напоминания об оплате**: За неделю до окончания подписки

## Установка и запуск

### Локальная разработка

1. **Клонирование проекта**:
   ```bash
   git clone <repository-url>
   cd bjj_crm
   ```

2. **Создание виртуального окружения**:
   ```bash
   python3 -m venv venv
   source venv/bin/activate  # Linux/Mac
   # или
   venv\Scripts\activate     # Windows
   ```

3. **Установка зависимостей**:
   ```bash
   pip install -r requirements.txt
   ```

4. **Настройка конфигурации**:
   ```bash
   cp .env.example .env
   # Отредактируйте .env файл с вашими настройками
   ```

5. **Инициализация базы данных**:
   ```bash
   python scripts/init_db.py
   ```

6. **Запуск приложения**:
   ```bash
   python main.py
   ```

### Развертывание на сервере

1. **Подготовка сервера**:
   ```bash
   # Установите sshpass для автоматического развертывания
   brew install hudochenkov/sshpass/sshpass  # Mac
   # или
   sudo apt install sshpass                  # Ubuntu
   ```

2. **Автоматическое развертывание**:
   ```bash
   chmod +x scripts/deploy.sh
   ./scripts/deploy.sh
   ```

3. **Проверка статуса**:
   ```bash
   ssh root@193.222.96.161 "systemctl status bjj-crm"
   ```

## Конфигурация

### Переменные окружения (.env)

```env
# База данных
DATABASE_URL=sqlite:///./bjj_crm.db
# Для продакшена: DATABASE_URL=postgresql://user:password@localhost/bjj_crm

# Telegram Bot
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
TELEGRAM_CHAT_ID=your_group_chat_id_here

# Google Calendar
GOOGLE_CALENDAR_CREDENTIALS_FILE=credentials.json
GOOGLE_CALENDAR_ID=your_calendar_id_here

# Настройки приложения
APP_NAME=BJJ Academy CRM
APP_VERSION=1.0.0
DEBUG=True

# Расписание тренировок
TRAINING_DAYS=Monday,Wednesday,Friday
TRAINING_TIME=20:30

# Цены
MONTHLY_SUBSCRIPTION_PRICE=8000
SINGLE_TRAINING_PRICE=1500

# Уведомления
NOTIFICATION_MISSED_CLASSES_THRESHOLD=2
NOTIFICATION_ENABLED=True
```

## Использование системы

### Добавление нового ученика

1. Откройте вкладку "Ученики"
2. Нажмите "Добавить ученика"
3. Заполните форму:
   - Имя и фамилия
   - Номер телефона
   - Telegram ID (опционально)
   - Email (опционально)
   - Текущий пояс (по умолчанию White)
   - Заметки (опционально)
4. Нажмите "Сохранить"

### Отметка посещаемости

1. Откройте вкладку "Тренировки"
2. Выберите тренировку из списка
3. Отметьте присутствующих учеников
4. Сохраните изменения

### Обработка платежей

1. Откройте вкладку "Платежи"
2. Нажмите "Добавить платеж"
3. Выберите ученика
4. Укажите сумму и тип платежа
5. Добавьте описание (опционально)
6. Сохраните платеж

### Просмотр отчетов

1. Откройте вкладку "Отчеты"
2. Выберите период отчета
3. Просмотрите статистику:
   - Общая выручка
   - Количество активных учеников
   - Статистика посещаемости
   - Прогресс по поясам

## Автоматические функции

### Резервное копирование

Система автоматически создает резервные копии:
- **База данных**: Ежедневно в 2:00
- **Файлы приложения**: Ежедневно в 2:00
- **Хранение**: 7 дней

### Уведомления

Автоматические уведомления отправляются:
- **За 2 часа до тренировки**: Напоминание всем ученикам
- **При пропуске 2+ занятий**: Мотивационное сообщение
- **За неделю до окончания подписки**: Напоминание об оплате
- **При успешном экзамене на пояс**: Поздравление

## Устранение неполадок

### Проблемы с запуском

1. **Ошибка tkinter**:
   ```bash
   # Mac
   brew install python-tk
   
   # Ubuntu
   sudo apt install python3-tk
   ```

2. **Ошибка базы данных**:
   ```bash
   # Пересоздайте базу данных
   rm bjj_crm.db
   python scripts/init_db.py
   ```

3. **Проблемы с зависимостями**:
   ```bash
   # Пересоздайте виртуальное окружение
   rm -rf venv
   python3 -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   ```

### Проблемы с Telegram

1. **Проверьте токен бота**: Убедитесь, что токен правильный
2. **Проверьте Chat ID**: Убедитесь, что бот добавлен в группу
3. **Проверьте права бота**: Бот должен иметь права на отправку сообщений

### Проблемы с сервером

1. **Проверьте статус сервиса**:
   ```bash
   ssh root@193.222.96.161 "systemctl status bjj-crm"
   ```

2. **Просмотрите логи**:
   ```bash
   ssh root@193.222.96.161 "journalctl -u bjj-crm -f"
   ```

3. **Перезапустите сервис**:
   ```bash
   ssh root@193.222.96.161 "systemctl restart bjj-crm"
   ```

## Поддержка

При возникновении проблем:
1. Проверьте логи приложения
2. Убедитесь в правильности конфигурации
3. Проверьте подключение к базе данных
4. Проверьте работу Telegram бота

## Обновления

Для обновления системы:
1. Остановите сервис: `systemctl stop bjj-crm`
2. Обновите код: `git pull`
3. Обновите зависимости: `pip install -r requirements.txt`
4. Запустите миграции (если есть)
5. Запустите сервис: `systemctl start bjj-crm`
